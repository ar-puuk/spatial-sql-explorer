<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spatial SQL Explorer</title>

    <!-- ── Cross-Origin Isolation for SharedArrayBuffer (needed by DuckDB-WASM) ── -->
    <!-- coi-serviceworker adds the required COOP/COEP headers on GitHub Pages     -->
    <script src="coi-serviceworker.min.js"></script>

    <!-- ── MapLibre GL JS ───────────────────────────────────────────────────────── -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maplibre-gl@5/dist/maplibre-gl.css" />
    <script src="https://cdn.jsdelivr.net/npm/maplibre-gl@5/dist/maplibre-gl.js"></script>
    <link rel="stylesheet"
        href="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.5.0/dist/maplibre-gl-geocoder.css" />
    <script src="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.5.0/dist/maplibre-gl-geocoder.min.js"></script>

    <!-- ── App Styles ───────────────────────────────────────────────────────────── -->
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>

    <!-- ════════════════════════════════════════════════════════════
     INIT OVERLAY — shown while DuckDB + map are loading
     ════════════════════════════════════════════════════════════ -->
    <div id="init-overlay">
        <div class="init-spinner"></div>
        <div class="init-title">Spatial SQL Explorer</div>
        <div class="init-log" id="init-log">Starting up…</div>
    </div>

    <!-- ════════════════════════════════════════════════════════════
     MAIN APP LAYOUT — three columns
     ════════════════════════════════════════════════════════════ -->
    <div id="app">

        <!-- ── LEFT PANEL: SQL Editor ─────────────────────────────── -->
        <div id="panel-left">

            <!-- Header -->
            <div id="app-header">
                <div id="app-title">⬡ Spatial SQL Explorer</div>
                <div id="app-subtitle">
                    Load GeoJSON, run SQL in DuckDB, watch map + table update together.
                </div>
            </div>

            <!-- Data Source -->
            <div id="data-source">
                <div class="section-label">Data Source</div>

                <div class="btn-row">
                    <button class="btn" id="btn-demo">Use Demo Data</button>
                    <button class="btn" onclick="document.getElementById('file-input').click()">
                        Choose GeoJSON
                    </button>
                </div>

                <input type="file" id="file-input" accept=".geojson,.json" />

                <div id="drop-zone">
                    <span>⬆</span>
                    Drop a <code>.geojson</code> file here, or click to browse
                </div>

                <div id="table-info">Loading…</div>
            </div>

            <!-- SQL Editor Label -->
            <div id="editor-section">
                <div id="editor-label">
                    <div class="section-label" style="margin-bottom:0">SQL Query</div>
                    <span id="editor-hint">Ctrl+Enter to run</span>
                </div>
                <div id="editor-wrapper"></div>
            </div>

            <!-- Run Controls -->
            <div id="run-controls">
                <button class="btn btn-primary" id="run-btn">▶ Run Query</button>
                <span id="safety-cap-label">LIMIT</span>
                <input type="number" id="safety-cap-input" value="1000" min="1" max="10000"
                    title="Safety cap: auto-adds LIMIT if your query doesn't have one" />
            </div>

            <!-- Query History -->
            <div id="query-history">
                <div class="section-label">Query History</div>
                <!-- History items injected by JS -->
            </div>

        </div>
        <!-- end panel-left -->


        <!-- ── CENTER PANEL: Map ──────────────────────────────────── -->
        <div id="panel-map">
            <div id="map"></div>
            <div id="map-statusbar">
                <span id="map-coords">–</span>
                <span id="map-engine">DuckDB WASM + spatial extension + MapLibre</span>
            </div>
        </div>
        <!-- end panel-map -->


        <!-- ── RIGHT PANEL: Query Output ─────────────────────────── -->
        <div id="panel-right">

            <div id="output-header">
                <div id="output-title">Query Output</div>
                <div id="output-meta">Run a query to see results.</div>
            </div>

            <div id="error-banner"></div>

            <div id="query-loading">
                <div class="mini-spinner"></div>
                Executing query…
            </div>

            <!-- Empty state shown before first query -->
            <div id="empty-state">
                <div class="empty-icon">⬡</div>
                <p>Write a SQL query in the editor<br>and press <strong>Run Query</strong><br>to see results here.</p>
            </div>

            <!-- Table injected here by JS -->
            <div id="table-wrapper"></div>

        </div>
        <!-- end panel-right -->

    </div>
    <!-- end #app -->

    <!-- ── App Logic (ES Module) ───────────────────────────────── -->
    <script type="module" src="js/app.js"></script>

</body>

</html>
